# Red Team Transport Layer æœ€ç»ˆæ–¹æ¡ˆ

## ä½ çš„é—®é¢˜ âœ…

> æˆ‘è§‰å¾—å…¶å®è¿˜æ˜¯æƒ³ç”¨ç°æœ‰çš„skill browser automationçš„skillï¼Œè¿™æ ·å¤ç”¨æ€§æ˜¯ä¸æ˜¯å¼ºä¸€äº›ï¼Ÿ

**ä½ è¯´å¾—å¯¹ï¼** æˆ‘å·²ç»æŒ‰ä½ çš„å»ºè®®ä¿®æ”¹äº†å®ç°ã€‚

## æœ€ç»ˆå®ç°ï¼šä¸¤ç§æ¨¡å¼ï¼Œé»˜è®¤ä½¿ç”¨ playwright-skill

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BrowserTransport                                         â”‚
â”‚                                                            â”‚
â”‚  if use_playwright_skill (é»˜è®¤True):                     â”‚
â”‚      â†’ è°ƒç”¨ playwright-skill âœ…                          â”‚
â”‚  else:                                                     â”‚
â”‚      â†’ ç”Ÿæˆ Playwright è„šæœ¬ (fallback)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | playwright-skillï¼ˆé»˜è®¤ï¼‰| ç›´æ¥è„šæœ¬ï¼ˆfallbackï¼‰|
|-----|------------------------|-------------------|
| æ–¹æ³• | `Skill("playwright-skill")` | `Bash("python script.py")` |
| å¤ç”¨æ€§ | âœ… é«˜ï¼ˆé€šç”¨skillï¼‰ | âŒ ä½ï¼ˆä»…red-teamï¼‰|
| ç»´æŠ¤ | âœ… ç¤¾åŒºç»´æŠ¤ | âŒ è‡ªå·±ç»´æŠ¤ |
| çµæ´»æ€§ | âœ… æé«˜ | âš ï¸ å›ºå®šé€»è¾‘ |
| ä»£ç é‡ | âœ… å°‘ï¼ˆä»»åŠ¡æè¿°ï¼‰ | âŒ å¤šï¼ˆ100+è¡Œï¼‰|
| æ¨è | âœ… YES | âš ï¸ ä»…fallback |

## ä½¿ç”¨æ–¹å¼

### é»˜è®¤ï¼ˆæ¨èï¼‰ï¼šè‡ªåŠ¨ä½¿ç”¨ playwright-skill

```python
# Red Team subagentä¸­
transport = TransportFactory.create_auto(target_url)

instruction = transport.send(payload)
# â†’ {"method": "skill", "skill": "playwright-skill", "args": "..."}

# æ‰§è¡Œ
Skill("playwright-skill", args=instruction["args"])
```

### æ‰‹åŠ¨æŒ‡å®š fallback æ¨¡å¼

```python
config = TransportConfig(
    target_url=url,
    transport_type="browser",
    use_playwright_skill=False  # ä½¿ç”¨ç›´æ¥è„šæœ¬
)
transport = TransportFactory.create(config)

instruction = transport.send(payload)
# â†’ {"method": "bash", "command": "python script.py"}

# æ‰§è¡Œ
Bash(instruction["command"])
```

## ä¸ºä»€ä¹ˆç”¨ playwright-skillï¼Ÿ

### 1. å¤ç”¨æ€§å¼º âœ…

**playwright-skillï¼š** æ‰€æœ‰skilléƒ½èƒ½ç”¨
```
red-team â”€â”
          â”œâ”€â†’ playwright-skill â†’ æµè§ˆå™¨
web-scraperâ”€â”˜
```

**è‡ªå·±ç”Ÿæˆè„šæœ¬ï¼š** åªæœ‰red-teamèƒ½ç”¨
```
red-team â†’ è‡ªå·±çš„è„šæœ¬ â†’ æµè§ˆå™¨
web-scraper â†’ åˆè¦è‡ªå·±å®ç°ä¸€é âŒ
```

### 2. ç»´æŠ¤æˆæœ¬ä½ âœ…

**playwright-skillï¼š**
- GitHubç¤¾åŒºç»´æŠ¤
- Bugä¿®å¤å’Œæ–°åŠŸèƒ½è‡ªåŠ¨å—ç›Š
- Playwright APIæ›´æ–°è‡ªåŠ¨é€‚é…

**è‡ªå·±ç”Ÿæˆè„šæœ¬ï¼š**
- éœ€è¦è‡ªå·±ç»´æŠ¤
- éœ€è¦è‡ªå·±ä¿®bug
- Playwright APIæ›´æ–°éœ€è¦æ‰‹åŠ¨æ”¹ä»£ç 

### 3. çµæ´»æ€§é«˜ âœ…

**playwright-skillï¼š** è‡ªç„¶è¯­è¨€æè¿°ï¼Œæ”¯æŒä»»æ„æ“ä½œ
```python
# éœ€æ±‚å˜åŒ–ï¼Ÿåªéœ€æ”¹ä»»åŠ¡æè¿°
task = """
1. Navigate
2. Fill input
3. Take screenshot  â† æ–°éœ€æ±‚ï¼Œä¸éœ€è¦æ”¹ä»£ç 
4. Press Enter
"""
```

**è‡ªå·±ç”Ÿæˆè„šæœ¬ï¼š** å›ºå®šé€»è¾‘ï¼Œæ”¹éœ€æ±‚è¦æ”¹ä»£ç 
```python
# éœ€æ±‚å˜åŒ–ï¼Ÿéœ€è¦ä¿®æ”¹transport.py
def _generate_playwright_script():
    # éœ€è¦æ·»åŠ  page.screenshot() âŒ
    # éœ€è¦æµ‹è¯• âŒ
```

### 4. ä»£ç ç®€æ´ âœ…

**playwright-skillï¼š** 30è¡Œ
```python
def _generate_playwright_task(self, payload: str) -> str:
    return f'''Navigate to {url}
    1. Find input
    2. Fill: {payload}
    3. Press Enter
    '''
```

**è‡ªå·±ç”Ÿæˆè„šæœ¬ï¼š** 100+è¡Œ
```python
def _generate_playwright_script(self, payload: str) -> str:
    return f'''
from playwright.sync_api import sync_playwright
import time
# ... 100+ lines ...
'''
```

## å®é™…æµ‹è¯•

```bash
$ python test_browser_modes.py http://localhost:8082

MODE 1: playwright-skill âœ…
  Method: skill
  â†’ è°ƒç”¨ç°æœ‰skill

MODE 2: Direct script âœ…
  Method: bash
  â†’ ç”Ÿæˆå¹¶æ‰§è¡Œè„šæœ¬

ğŸ¯ Recommendation: Use Mode 1 (playwright-skill)
```

## ä¾èµ–å®‰è£…

### playwright-skill

```bash
cd ~/.claude/skills
git clone https://github.com/lackeyjb/playwright-skill
cd playwright-skill
pip install -r requirements.txt
```

### Playwrightï¼ˆä¸¤ç§æ¨¡å¼éƒ½éœ€è¦ï¼‰

```bash
pip install playwright
playwright install chromium
```

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

```
~/.claude/skills/red-team/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ transport.py              â˜… æ”¯æŒä¸¤ç§æ¨¡å¼
â”‚   â”œâ”€â”€ test_browser_modes.py    â˜… æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ adaptive_attack.py        (ä¸éœ€è¦æ”¹)
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ä¸ºä»€ä¹ˆç”¨playwright-skill.md  â˜… è¯¦ç»†è¯´æ˜
â”‚   â””â”€â”€ æœ€ç»ˆæ–¹æ¡ˆ.md                  â˜… æœ¬æ–‡æ¡£
â””â”€â”€ README-TRANSPORT.md           â˜… å·²æ›´æ–°
```

### ä»£ç ä¿®æ”¹

**transport.py ä¸»è¦æ”¹åŠ¨ï¼š**

```python
@dataclass
class TransportConfig:
    use_playwright_skill: bool = True  # æ–°å¢ï¼šé»˜è®¤True

class BrowserTransport:
    def send(self, payload: str):
        if self.config.use_playwright_skill:
            # ä½¿ç”¨playwright-skillï¼ˆé»˜è®¤ï¼‰
            return self._send_via_playwright_skill(payload)
        else:
            # ç”Ÿæˆè„šæœ¬ï¼ˆfallbackï¼‰
            return self._send_via_direct_script(payload)

    def _send_via_playwright_skill(self, payload: str):
        """è°ƒç”¨playwright-skill"""
        task = self._generate_playwright_task(payload)
        return {
            "method": "skill",
            "skill": "playwright-skill",
            "args": task
        }

    def _send_via_direct_script(self, payload: str):
        """ç”ŸæˆPlaywrightè„šæœ¬"""
        script = self._generate_playwright_script(payload)
        # ä¿å­˜å¹¶è¿”å›æ‰§è¡ŒæŒ‡ä»¤
        return {
            "method": "bash",
            "command": "python script.py"
        }
```

## ä¸å…¶ä»–Transportçš„å…³ç³»

```
Transport Layer
â”œâ”€â”€ BrowserTransport
â”‚   â”œâ”€â”€ Mode 1: playwright-skill âœ… é»˜è®¤
â”‚   â””â”€â”€ Mode 2: Direct script (fallback)
â”œâ”€â”€ AgentProxyTransport
â”‚   â””â”€â”€ è°ƒç”¨ agent-proxy skill âœ… å¤ç”¨
â””â”€â”€ WebSocketTransport
    â””â”€â”€ Python WebSocketåº“
```

**ä¸€è‡´çš„è®¾è®¡åŸåˆ™ï¼š** ä¼˜å…ˆä½¿ç”¨ç°æœ‰skillï¼Œå‡å°‘é‡å¤ä»£ç ï¼

## æ€»ç»“

### âœ… ä½ çš„å»ºè®®æ˜¯å¯¹çš„

ä½¿ç”¨ç°æœ‰çš„playwright-skillç¡®å®æ›´å¥½ï¼ŒåŸå› ï¼š

1. **âœ… å¤ç”¨æ€§å¼º** - æ‰€æœ‰skillå…±äº«ï¼Œä¸é‡å¤é€ è½®å­
2. **âœ… ç»´æŠ¤æˆæœ¬ä½** - ç¤¾åŒºç»´æŠ¤ï¼Œè‡ªåŠ¨æ”¹è¿›
3. **âœ… çµæ´»æ€§é«˜** - è‡ªç„¶è¯­è¨€æè¿°ï¼Œé€‚åº”æ€§å¼º
4. **âœ… ä»£ç ç®€æ´** - åªéœ€ä»»åŠ¡æè¿°ï¼Œä¸éœ€è¦å†™Playwrightä»£ç 
5. **âœ… æŒç»­æ”¹è¿›** - ç¤¾åŒºæ”¯æŒï¼Œbugä¿®å¤å’Œæ–°åŠŸèƒ½

### ğŸ“‹ æœ€ç»ˆå®ç°

- **é»˜è®¤ä½¿ç”¨ playwright-skill**ï¼ˆæ¨¡å¼1ï¼‰
- **ä¿ç•™ç›´æ¥è„šæœ¬**ï¼ˆæ¨¡å¼2ï¼‰ä½œä¸ºfallback
- **è‡ªåŠ¨æ£€æµ‹**ç›®æ ‡ç±»å‹
- **ç»Ÿä¸€æ¥å£** `transport.send(payload)`

### ğŸ¯ æ¨èé…ç½®

```python
# é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰
transport = TransportFactory.create_auto(target_url)
# â†’ è‡ªåŠ¨æ£€æµ‹ä¸ºbrowser
# â†’ è‡ªåŠ¨ä½¿ç”¨playwright-skill
# â†’ è¿”å›SkillæŒ‡ä»¤
```

## ä¸‹ä¸€æ­¥

ä½ ç°åœ¨å¯ä»¥ï¼š

1. **æµ‹è¯•ä¸¤ç§æ¨¡å¼**
   ```bash
   cd ~/.claude/skills/red-team/scripts
   python test_browser_modes.py http://localhost:8082
   ```

2. **æŸ¥çœ‹è¯¦ç»†å¯¹æ¯”**
   ```bash
   cat docs/ä¸ºä»€ä¹ˆç”¨playwright-skill.md
   ```

3. **ç›´æ¥ä½¿ç”¨**
   ```bash
   /red-team http://localhost:8082
   # è‡ªåŠ¨ä½¿ç”¨playwright-skill
   ```

**æ„Ÿè°¢ä½ çš„å»ºè®®ï¼ä½¿ç”¨ç°æœ‰skillç¡®å®æ˜¯æ›´å¥½çš„æ¶æ„è®¾è®¡ï¼** ğŸ‰
